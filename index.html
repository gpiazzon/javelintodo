<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Javelin Training Checklist</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json" />
  <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/lucide.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="settings.js"></script>
</head>
<body>
  <header class="header">
    <button id="prev-day" class="nav-btn" aria-label="Previous Day"><i data-lucide="chevron-left"></i></button>
    <h1 id="date" class="date-title"></h1>
    <button id="next-day" class="nav-btn" aria-label="Next Day"><i data-lucide="chevron-right"></i></button>
    <a href="settings.html" class="nav-btn" aria-label="Settings"><i data-lucide="settings"></i></a>
  </header>

  <main>
    <p id="motivation"></p>
    <section id="task-container"></section>
  </main>

  <script src="tasks.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const settings = loadSettings();
      const dateEl = document.getElementById('date');
      const container = document.getElementById('task-container');
      const prevBtn = document.getElementById('prev-day');
      const nextBtn = document.getElementById('next-day');
      const motivationEl = document.getElementById('motivation');
      let currentDate = new Date();

      function applyDaySettings(dayKey) {
        const color = settings.colors[dayKey];
        if (color) document.body.style.setProperty('--accent', color);
        motivationEl.style.display = settings.showQuotes ? '' : 'none';
        motivationEl.textContent = motivationByDay[dayKey] || '';
      }

      function render() {
        container.innerHTML = '';
        const key = currentDate.toLocaleDateString(undefined,{weekday:'long'}).toLowerCase();
        document.body.className = key;
        dateEl.textContent = currentDate.toLocaleDateString(undefined,{weekday:'long',month:'short',day:'numeric'});
        applyDaySettings(key);
        const dayData = getTasksFor(key, currentDate);
        for (let [group, data] of Object.entries(dayData)) {
          const groupEl = document.createElement('div');
          groupEl.className = 'task-group';
          const h2 = document.createElement('h2'); h2.textContent = group;
          groupEl.appendChild(h2);
          if (data.note) {
            const p = document.createElement('p'); p.className = 'note'; p.textContent = data.note;
            groupEl.appendChild(p);
          }
          const ul = document.createElement('ul');
          data.items.forEach((task,i) => {
            const id = `${key}-${group}-${i}`;
            const li = document.createElement('li'); li.className='task-item';
            const chk = document.createElement('input'); chk.type='checkbox'; chk.id=id;
            chk.checked=JSON.parse(localStorage.getItem(id)||false);
            chk.addEventListener('change',()=>{
              localStorage.setItem(id,chk.checked);
              li.classList.toggle('completed',chk.checked);
              if(chk.checked) {
                ul.appendChild(li);
                confetti({particleCount:30,spread:55,origin:{y:0.6},colors:settings.confettiColors});
              } else {
                ul.insertBefore(li,ul.children[i]);
              }
            });
            const lbl = document.createElement('label'); lbl.htmlFor=id;
            lbl.innerHTML = `<span class="task-emoji">${settings.emoji}</span> ${task}`;
            li.append(chk,lbl);
            if(chk.checked) li.classList.add('completed');
            ul.appendChild(li);
          });
          groupEl.appendChild(ul);
          container.appendChild(groupEl);
        }
        lucide.replace();
      }

      prevBtn.onclick = () => { currentDate.setDate(currentDate.getDate()-1); render(); };
      nextBtn.onclick = () => { currentDate.setDate(currentDate.getDate()+1); render(); };
      render();
    });
  </script>
</body>
</html>
